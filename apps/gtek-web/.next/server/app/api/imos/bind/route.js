"use strict";(()=>{var e={};e.id=838,e.ids=[838],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},2241:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},6718:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>x,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var s={};t.r(s),t.d(s,{POST:()=>d,runtime:()=>p});var o=t(7506),i=t(5624),n=t(1301),a=t(3092),u=t(50);let p="nodejs";async function d(e){let{vault_code:r,crid:t,org_id:s}=await e.json();if(!r||!t)return a.NextResponse.json({error:"vault_code+crid required"},{status:400});let o=function(){let e=process.env.SUPABASE_URL||process.env.NEXT_PUBLIC_SUPABASE_URL,r=process.env.SUPABASE_SERVICE_ROLE;return e&&r?(0,u.eI)(e,r):null}();if(!o)return a.NextResponse.json({ok:!0,vault_code:r,crid:t,mock:!0});let{data:i,error:n}=await o.from("vaults").select("id, org_id").eq("vault_code",r).single();if(n||!i)return a.NextResponse.json({error:"vault not found"},{status:404});let{error:p}=await o.from("vaults").update({crid:t}).eq("id",i.id);return p?a.NextResponse.json({error:p.message},{status:500}):(await o.from("external_registry_links").insert({org_id:s||i.org_id,vault_id:i.id,registry:"IMOS",reference:t}),await o.from("audit_logs").insert({org_id:s||i.org_id,action:"imos.bind",entity:"vaults",entity_id:i.id,meta:{vault_code:r,crid:t}}),a.NextResponse.json({ok:!0,vault_code:r,crid:t}))}let l=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/imos/bind/route",pathname:"/api/imos/bind",filename:"route",bundlePath:"app/api/imos/bind/route"},resolvedPagePath:"/Users/bfh/gTek-SaaS_GLOBAL-ENTERPRISE-TEMPLATES-WEBSITE/apps/gtek-web/app/api/imos/bind/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:c,serverHooks:m}=l,q="/api/imos/bind/route";function v(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[202,151,50],()=>t(6718));module.exports=s})();